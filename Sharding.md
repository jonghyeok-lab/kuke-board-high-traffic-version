# 분산 DB 시스템
## 샤딩 개념

---
- 샤딩을 이용하여 데이터를 여러 DB에 분산할 수 있다.
- 샤딩된 각각의 데이터 단위를 샤드라 부른다.
```angular2html
-----shard----          -----shard-----
|    table   |          |    table    |
--------------          ---------------
- 샤딩: 데이터를 여러 DB에 분산하여 저장하는 기술
- 샤드: 샤딩된 각각의 데이터 단위
```
### 수직 샤딩
- 데이터를 수직으로 분할하는 방식(컬럼 단위)
```angular2html
- article_id 식별자를 이용해 좌측 샤드(title/content), 우측 샤드(board_id/created_at) 분산 저장
-----shard----          -----shard-----
|   article   |         |   article   |
|=============|         |=============|         
|  article_id |         |  article_id |
|    title    |         |   borad_id  |
|    content  |         |   created_at|
--------------          ---------------
```
- 각 샤드가 적은 수의 컬럼을 저장
  - 성능 및 공간 이점이 생김
  - 조인 또는 트랜잭션 관리가 복잡
  - 수직으로 분할되기 때문에 수평 확장에 제한이 있음

### 수평 샤딩
- 데이터를 행 단위로 분할하는 방식
```angular2html
- 좌측 샤드(article_id=1~5000), 우측 샤드(article_id=5001~10000) 분산 저장
----------shard-------       ----------shard-----------
|        article     |       |         article        |
|====================|       |========================|         
|  article_id=1~5000 |       |  article_id=5001~10000 |
----------------------       --------------------------
```
- 각 샤드가 적은 수의 컬럼을 저장
    - 성능 및 공간 이점이 생김
    - 조인 또는 트랜잭션 관리가 복잡
    - 수평으로 분할되기 때문에 수평 확장에 유리

## 샤딩 예시

---
### Range-based Sharding(범위 기반 샤딩)
- Shard Key(`article_id`)를 범위에 따라 분할
  - 좌측 샤드 article_id = 1~5000
  - 우측 샤드 article_id = 5001~10000
- 장점
  - 범위 데이터 조회 유리
    - article_id=100 부터 30개 조회 시, 좌측 샤드에서만 조회
- 단점
  - 데이터 쏠림 현상 가능
    - 데이터가 6000개만 있으면 우측 샤드는 1000개만 저장.

### Hash-based Sharding(해시 기반 샤딩)
- Shard Key를 해시 함수에 따라 분할
  - hash_function = article_id % 2 라면?
    - 좌측 샤드: article_id=1,3,5 ...
    - 우측 샤드: article_id=2,4,6 ...
- 특징
  - Shard Key와 해시 함수가 매우 중요
    - board_id 가 Shard Key 라면 인기 많은 게시판에 데이터가 쏠릴 수 있음
  - 범위 데이터 조회에 불리할 수 있다.(article_id % 2 일 경우)
  - 시스템 특성에 따라 Shard Key와 해시함수를 선정해야 한다.

### Directory-based Sharding(디렉토리 기반 샤딩)
- 디렉토리를 이용해 데이터가 저장된 샤드를 관리
- 매핑 테이블(디렉토리) 관리 비용 있음

## 논리적 샤드 vs 물리적 샤드
- 물리적 샤드
  - 데이터를 물리적으로 분산 -> 데이터 분산 및 저장 성능 향상
- 논리적 샤드
  - 물리적 확장 시, Client 변경 없이 유연한 매핑.